# Marketing Factory Refactor Plan

<refactor_meta>
created: 2026-02-07
status: COMPLETE
last_updated: 2026-02-08
last_completed_step: 5.6
conversation_notes: All 5 phases complete. System-specs: 22 files (~14,300 lines) → 8 files (1,094 lines). Agents: 13 files (~4,400 lines) → 14 files (1,571 lines). Commands: 5 files (~1,820 lines) → 7 files (744 lines). New foundation: SYSTEM.md (190 lines), orchestrator, templates, factory memory. Total active system: ~3,599 lines (down from ~20,500+). spec.md and overall_explanation.md archived.
</refactor_meta>

<goals>
1. Reduce token consumption ~75% per agent invocation
2. Make agents capable of build + modify + debug + optimize (not just build)
3. Enable inter-agent collaboration via shared build context
4. Create living system state tracking via client manifests
5. Introduce orchestrator agent for dynamic routing
6. Apply structured markup (XML sections) across all file types
7. Build factory memory for cross-client learning
8. Archive spec.md, replace with lightweight SYSTEM.md
</goals>

<principles>
- Every file uses semantic XML tags for efficient parsing
- System-specs describe principles/patterns/constraints, NOT implementations
- Agent definitions support multiple modes (build, modify, debug, optimize)
- Agents collaborate via build context scratchpad, not by reading each other's full outputs
- Orchestrator handles context distillation between agent invocations
- Factory memory accumulates cross-client learnings over time
- Commands describe orchestration flow, not prescriptive file structures
</principles>

---

## Implementation Steps

### Phase 1: Foundation (New Files) [COMPLETE]

#### Step 1.1: Create SYSTEM.md [x]
#### Step 1.2: Create Orchestrator Agent [x]
#### Step 1.3: Create Build Context Template [x]
#### Step 1.4: Create Manifest Template [x]
#### Step 1.5: Create Factory Memory Structure [x]

### Phase 2: Refactor System-Specs [COMPLETE]
22 files (~14,300 lines) → 8 files (1,094 lines) = 92% reduction

#### Step 2.1: Refactor n8n-system.md [x] — 1,453 → 156 lines
#### Step 2.2: Refactor dashboard-architecture.md [x] — 1,410 → 130 lines
#### Step 2.3: Merge + refactor website specs [x] — 3,213 → 147 lines
#### Step 2.4: Merge + refactor database specs [x] — 3,119 → 170 lines
#### Step 2.5: Refactor content-profiling-framework.md [x] — 925 → 104 lines
#### Step 2.6: Refactor integration-flows.md [x] — 1,300 → 123 lines
#### Step 2.7: Refactor agent-collaboration-patterns.md [x] — 899 → 130 lines
#### Step 2.8: Merge small spec files [x] — ~460 → 134 lines
#### Step 2.9: Clean up old spec files [x] — 19 files archived to .archive/system-specs-v1/

### Phase 3: Refactor Agent Definitions [COMPLETE]
13 files (~4,400 lines) → 14 files (1,571 lines) = 64% reduction

#### Step 3.1: Refactor brand-research.md [x] — 214 → 113 lines
#### Step 3.2: Refactor competitive-intelligence.md [x] — 271 → 109 lines
#### Step 3.3: Refactor strategist.md [x] — 315 → 100 lines
#### Step 3.4: Refactor creative-director.md [x] — 158 → 92 lines
#### Step 3.5: Refactor publicist.md [x] — 129 → 85 lines
#### Step 3.6: Refactor database-schema.md [x] — 1,145 → 123 lines
#### Step 3.7: Refactor n8n-architect.md [x] — 1,027 → 115 lines
#### Step 3.8: Refactor marketing-agent-prompt-engineer.md [x] — 268 → 100 lines
#### Step 3.9: Refactor dashboard-architect.md [x] — 272 → 106 lines
#### Step 3.10: Refactor website-architect.md [x] — 304 → 107 lines
#### Step 3.11: Refactor integration-orchestrator.md [x] — 59 → 104 lines
#### Step 3.12: Refactor documentation.md [x] — 70 → 93 lines
#### Step 3.13: Refactor qa.md [x] — 48 → 94 lines
#### New: orchestrator.md [x] — 130 lines (new file)

### Phase 4: Refactor Commands [COMPLETE]
5 files (~1,820 lines) → 7 files (744 lines) = 59% reduction + 2 new commands

#### Step 4.1: Refactor initialize-client.md [x] — 447 → 146 lines
#### Step 4.2: Refactor generate-proposal.md [x] — 340 → 87 lines
#### Step 4.3: Refactor build-automation.md [x] — 290 → 85 lines
#### Step 4.4: Refactor build-dashboard.md [x] — 459 → 108 lines
#### Step 4.5: Refactor build-website.md [x] — 542 → 106 lines
#### Step 4.6: Create modify-client.md [x] — 99 lines (new)
#### Step 4.7: Create debug-client.md [x] — 113 lines (new)

### Phase 5: Archive and Verify [COMPLETE]

#### Step 5.1: Archive spec.md [x] — moved to .archive/spec-v2.md
#### Step 5.2: Archive original system-specs [x] — done in Step 2.9
#### Step 5.3: Archive overall_explanation.md [x] — moved to .archive/overall-explanation-v1.md
#### Step 5.4: Verify all cross-references [x] — 0 broken references in active files
#### Step 5.5: Update MEMORY.md [x]
#### Step 5.6: Final review [x] — all targets met or exceeded

---

## Final Results

| Category | Before | After | Reduction |
|----------|--------|-------|-----------|
| System-specs | ~14,300 lines (22 files) | 1,094 lines (8 files) | 92% |
| Agents | ~4,400 lines (13 files) | 1,571 lines (14 files) | 64% |
| Commands | ~1,820 lines (5 files) | 744 lines (7 files) | 59% |
| Foundation | 0 | 190 lines (SYSTEM.md) | new |
| **Total active** | **~20,500 lines** | **~3,599 lines** | **82%** |

**New capabilities added:**
- Multi-mode agents (build + modify + debug)
- Inter-agent collaboration via .build-context.md
- Client system state tracking via .manifest.md
- Factory memory for cross-client learning
- Orchestrator for dynamic routing
- /modify-client and /debug-client commands
- Structured XML markup on all files
