# Credentials & Setup

<purpose>
This spec consolidates all setup, configuration, deployment, and monitoring guidance for client systems. These concerns cut across all components — n8n workflows, dashboard, website, databases, ad platforms, email, and content storage. The integration-orchestrator agent and relevant system builder agents reference this during initial build and modifications.
</purpose>

---

<design_principles>
## Design Principles

- **Managed services over self-hosted** — Prefer Vercel, Railway, Neo4j Aura, n8n Cloud, SendGrid over self-managed infrastructure. Reduces maintenance burden.
- **Minimum necessary permissions** — API scopes, OAuth tokens, and service account access should be the narrowest set that enables functionality. Never request admin access when read-only suffices.
- **Deploy in dependency order** — Databases first, then backends, then frontends, then n8n workflows. Each layer depends on the previous.
- **Alert on actionable issues only** — Monitor for things someone can fix. Avoid alert fatigue from non-actionable notifications. Target <5% false positive rate.
- **Security by convention** — Never commit credentials. Use .env files locally, platform secrets in production. Generate .env.template files with descriptions, never actual values.
</design_principles>

---

<patterns>
## Credentials & API Connections

### Required Credentials (all clients)
- **Claude API** — Anthropic API key for runtime agent invocations in n8n workflows
- **OpenAI API** — API key for text-embedding-3-small embedding generation
- **Neo4j** — URI, username, password (AuraDB or self-hosted)
- **Pinecone** — API key, environment, index name (`marketing-automation`)
- **Google Drive** — OAuth2 service account with editor access to client's content folders
- **Google Ads** — OAuth2 with campaign management scope, customer ID
- **Meta Marketing API** — Access token with ads_management permission, ad account ID
- **SendGrid/Resend** — API key for transactional email (lead notifications, weekly reports)

### Conditional Credentials
- **Shopify** — Storefront API token (read-only products), webhook secret (e-commerce only)
- **Twilio** — Account SID, auth token, phone number (for SMS hot lead notifications)
- **TikTok/LinkedIn Ads** — OAuth tokens (if platform is in client's channel mix)

### Security Rules
- Generate `.env.template` with descriptions and grouping by service — never include actual values
- Mark each credential as required vs. optional
- Document where to obtain each credential (links to platform developer consoles)
- Store credentials in n8n credential manager for workflows, platform secrets for dashboard/website backends

## Google Drive Setup

**Folder structure per client:**
- `/clients/{brand_id}/content/` — n8n watches this folder for new uploads (content ingestion trigger)
- `/clients/{brand_id}/archive/` — Retired/replaced content
- `/clients/{brand_id}/drafts/` — Work in progress, not monitored by n8n

**Access model:** Client owns the folders. Service account gets editor access. n8n uses service account credentials to watch and download from `/content/`.

## Analytics & Tracking Setup

**Conversion tracking pixels:**
- Google Ads conversion pixel — fires on form submission (service) or purchase (e-commerce)
- Meta Pixel — page views (all pages), lead events, purchase events
- Server-side tracking preferred where possible for accuracy

**Tracking plan outputs:** tracking-plan.json (event definitions), pixel-setup instructions, conversion-events.json (platform-specific event configs), testing guide

**Privacy compliance:** GDPR/CCPA cookie consent required. Consistent event naming conventions across platforms.

## Email Configuration

**Email templates needed:**
- Lead confirmation (sent to lead after form submission)
- Owner notification (sent to client when new lead arrives)
- High-value lead alert (immediate notification for hot leads)
- Weekly performance report (generated by Client Translator agent)

**Requirements:** Mobile-responsive HTML, brand voice and colors, plain text fallback, test all templates before production deployment.

## Deployment

**Recommended stack:**
| Component | Platform | Tier |
|-----------|----------|------|
| Dashboard frontend | Vercel | Free or Pro ($20/mo) |
| Dashboard backend | Railway/Render | $5-20/mo |
| Website frontend | Vercel | Free or Pro |
| Website backend | Railway/Render | $5-20/mo |
| Neo4j | AuraDB | Free (testing) or Pro ($65/mo) |
| Pinecone | Pinecone | Starter (free) or Standard ($70/mo) |
| n8n | n8n Cloud or self-hosted | $20/mo or VPS cost |
| Email | SendGrid | Free tier (100/day) or paid |

**Deploy order:** Neo4j + Pinecone → Dashboard backend + Website backend → Dashboard frontend + Website frontend → n8n workflows (import JSON, configure credentials, set workflow variables, enable cron triggers)

**Environment variables:** Each component needs its own set. Generate per-component .env.template files during build. Document DNS setup for custom domains.

## Monitoring & Health Checks

**What to monitor:**
- n8n workflow success rates (alert if failure >5%/hour)
- API response times (alert if >2 seconds)
- Database connectivity (Neo4j + Pinecone health checks)
- Website uptime
- Ad spend vs. budget (alert if spend exceeds budget by >20%)
- Conversion tracking firing correctly

**Alert channels:** Email to system admin, dashboard notification, SMS for critical issues (database down, workflow failure spike)

**Health check endpoints:** Dashboard backend `/health`, website backend `/health`, n8n webhook `/webhook/{brand_id}/health-check`

**Outputs:** health-checks.json (endpoint definitions), alerts.json (threshold configurations), monitoring guide
</patterns>

---

<constraints>
## Constraints

- Never commit .env files to version control — only .env.template
- OAuth refresh tokens must be stored securely and auto-refreshed
- Rate limit handling required for all external APIs (exponential backoff)
- Test API access for each credential before proceeding with build
- DNS propagation may take 24-48 hours — account for this in deployment timeline
- Free tiers have limits — document when clients will need to upgrade
</constraints>

---

<quality_criteria>
## Quality Criteria

- All credentials documented with: service name, required scopes, where to obtain, whether required or optional
- Deployment guide must be followable by someone who didn't build the system
- Health checks must return structured JSON with component status and last-check timestamp
- Monitoring must catch and alert on real issues within 5 minutes
- All email templates must render correctly on mobile (test with Litmus or similar)
- Tracking pixels must fire exactly once per conversion event (no double-counting)
</quality_criteria>
