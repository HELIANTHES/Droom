# Dashboard Architecture

<purpose>
The dashboard is a full-stack analytics application that gives clients real-time visibility into campaign performance, content analytics, and AI-generated insights. It employs 3-level progressive disclosure so business owners see what matters in 30 seconds, while technical users can drill into granular media buyer metrics.

**Stack:** Next.js (TypeScript, App Router) frontend + FastAPI (Python) backend. Styled with Tailwind CSS, charted with Recharts. Data from Neo4j, Pinecone, and n8n webhooks. Deployed on Vercel (frontend) + Railway/Render (backend).
</purpose>

---

<design_principles>
## Design Principles

- **AI narratives first** — Data should tell a story. Every page leads with a natural-language summary generated by the Client Translator agent, not raw numbers. Numbers support the narrative.
- **Progressive disclosure** — Three distinct depth levels. Never force a business owner to see CPM breakdowns; never hide them from a media buyer.
- **Context always** — Every metric shows comparison: vs. last period, vs. target, vs. industry average when available. A number without context is meaningless.
- **Actionable insights** — Every insight includes "what this means" and "what the system did about it" (or "what to do"). No observation without implication.
- **No AI jargon** — Never expose "Claude," "vector DB," "embeddings," "agents" to the client. The system produces "insights" and "recommendations."
- **Mobile-first** — Business owners check dashboards on phones. Responsive design is mandatory, not optional.
- **Speed** — Target <500ms API response times. Cache aggressively (1 hour for metrics, 24 hours for configurations). Use polling or WebSockets for live updates.
</design_principles>

---

<patterns>
## Information Architecture

### Level 1: Executive View (`/`)
**Audience:** Business owner, 30-second scan
**Components:**
- AI narrative summary (3-4 sentences from Client Translator agent, cached 1 hour)
- 4 KPI cards: Spend (vs. budget), ROAS, Conversions, Revenue — each with directional change indicator
- 7-day performance trend sparkline
- Top 3 insights & opportunities (what happened + what the system did about it)
- Navigation to Level 2 categories

**Design rule:** Maximum 4 KPI cards + 1 narrative + 3 insights. Anything more overwhelms non-technical clients.

### Level 2: Category Views (one click deep)
**Audience:** Marketing manager or curious owner, 2-5 minute exploration

**Pages:**
- `/campaigns` — Platform performance comparison (bar chart), active campaign table with ROAS/budget/status, campaign management actions
- `/content` — Visual gallery of all content with performance overlays (ROAS, status, tone/aesthetic tags), filterable by status/type/performance, links to content detail
- `/content/[id]` — Individual content deep-dive: performance over time, which demographics respond to it, which campaigns used it, AI-generated content insights
- `/audiences` — Demographic performance breakdown, audience segment comparison, psychographic insights from Cultural Anthropologist agent
- `/geography` — Geographic heat map performance, area-by-area metrics, local targeting effectiveness
- `/insights` — Full AI-generated insight feed, organized by recency and impact, links to relevant data views

### Level 3: Detailed Metrics (`/detailed-metrics`)
**Audience:** Technical user, agency partner, 10+ minute analysis
**Content:** Every media buyer metric — CPM, CPC, CTR, frequency, reach, quality score, conversion rate, cost per conversion, ROAS — all with period-over-period change and industry averages where available
**Features:** Date range selector, platform filter, campaign filter, multi-axis time series charts, CSV export, platform-by-platform breakdown tables

### Utility Pages
- `/upload` — Content upload interface (drag-and-drop, progress tracking, shows analysis status from content ingestion workflow)
- `/settings` — Brand configuration, notification preferences, connected accounts

### Business Model Variations
- **Brick-and-mortar/service:** Lead-focused KPIs (leads, cost per lead, lead quality distribution), lead management table, form submission tracking
- **E-commerce:** Revenue-focused KPIs (purchases, ROAS, average order value, customer acquisition cost), purchase attribution view, Shopify integration status
- **Hybrid:** All features enabled, toggle between lead and revenue views
</patterns>

---

<interfaces>
## Backend API Structure

**Router organization** (FastAPI):
- `/api/performance/` — Aggregate metrics, time series, platform breakdowns, detailed metrics with filtering
- `/api/content/` — Content library, individual content details, content performance
- `/api/campaigns/` — Active/paused/completed campaigns, campaign management
- `/api/insights/` — AI-generated narratives, insight feed, opportunity recommendations
- `/api/leads/` — Lead management, lead scoring details, form submissions
- `/api/webhooks/` — Inbound webhooks from n8n (content-uploaded, performance-updated, lead-scored, purchase-attributed)

**Service clients:**
- Neo4j client — All structured queries (performance data, content metadata, campaign relationships, leads)
- Pinecone client — Semantic queries (similar content, audience psychographics)
- n8n client — Webhook communication, latest narrative retrieval

**Data flow:** n8n workflows push updates to dashboard via webhooks → dashboard stores/caches → frontend polls or receives WebSocket push → UI updates

**Environment variables:** NEO4J_URI, NEO4J_USER, NEO4J_PASSWORD, PINECONE_API_KEY, PINECONE_ENVIRONMENT, N8N_BASE_URL, BRAND_ID (backend). NEXT_PUBLIC_API_URL, NEXT_PUBLIC_BRAND_ID (frontend).
</interfaces>

---

<constraints>
## Constraints

- All Neo4j queries must filter by `brand_id` — single backend serves multiple clients
- API response time target: <500ms for all endpoints
- Cache TTL: 1 hour for metrics, 24 hours for configurations, invalidate on n8n webhook receipt
- Pagination required for content library and lead tables (default 20 items)
- Frontend must work on mobile viewports (320px minimum)
- Level 1 must load completely in <2 seconds on mobile
- CSV export available for all tabular data on Level 3
</constraints>

---

<quality_criteria>
## Quality Criteria

- Dashboard must render correctly on desktop, tablet, and mobile
- All data visualizations must include loading states and empty states
- Error boundaries on every page — one component failure must not crash the entire dashboard
- All API endpoints must validate brand_id and return appropriate errors
- Date ranges must default to last 7 days with options for 14d, 30d, 90d
- Every metric with a change indicator must compare to the equivalent prior period
- Upload interface must show real-time progress and analysis status
- Navigation between levels must feel instant (prefetch Level 2 pages from Level 1)
</quality_criteria>

---

<reference_examples>
## Cost & Deployment

**Monthly cost per client:**
- Frontend (Vercel): Free tier or $20/month (pro)
- Backend (Railway/Render): $5-20/month
- Total: ~$5-40/month per dashboard

**Architecture note:** Single backend can serve multiple client dashboards. Multi-tenant frontend possible, or separate deployments per client for isolation.

**Deployment:** Frontend via Vercel CLI (`vercel deploy`), backend via Docker or platform CLI. Both need environment variables configured for the specific client.
</reference_examples>
